{% extends "base.html" %}
{% block content %}
<h2>Generate Diet Plan</h2>
<p>Use your saved questionnaire (Prakriti/Agni/Ama) to generate a diet.</p>
<form method="POST">
  <button class="btn" type="submit">Generate Diet</button>
</form>

{% if plan %}
  <h3>Generated Plan</h3>
  {% for meal, items in plan.items() %}
    <h4>{{ meal }}</h4>
    <ul>
      {% for it in items %}
        <li>{{ it }} {% if evaluation[it] %} â€” <small>{{ evaluation[it].msg }}</small>{% endif %}</li>
      {% endfor %}
    </ul>
  {% endfor %}
  <h4>Nutrition summary (all items)</h4>
  <table class="nutrition">
    <tr><th>Item</th><th>Cal</th><th>Protein</th><th>Carbs</th><th>Fat</th></tr>
    {% for item,info in nutrition.details.items() %}
      <tr>
        <td>{{ item }}</td>
        <td>{{ info.calories }}</td>
        <td>{{ info.protein }}</td>
        <td>{{ info.carbs }}</td>
        <td>{{ info.fat }}</td>
      </tr>
    {% endfor %}
    <tr class="total">
      <td>Total</td>
      <td>{{ nutrition.total.calories }}</td>
      <td>{{ nutrition.total.protein }}</td>
      <td>{{ nutrition.total.carbs }}</td>
      <td>{{ nutrition.total.fat }}</td>
    </tr>
  </table>
  <a href="{{ url_for('diet_plan_page') }}">View Diet Plan</a>
{% endif %}
{% endblock %}
